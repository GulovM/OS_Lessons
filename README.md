# OS_Lessons
Здесь хранятся проекты по предмету ОС


---

## Второе задание (project2.cpp):
## Симуляция движения поездов по маршруту Душанбе–Дангара
Данная программа моделирует движение поездов по железнодорожной ветке `Душанбе → Дангара`, используя **многопоточность** и **механизмы синхронизации** в C++.
**Цель работы** - продемонстрировать:
  - корректную работу потоков (std::thread);
  - защиту общих ресурсов с помощью мьютексов (std::mutex);
  - моделирование задержек и событий в реальном времени;
  - обеспечение того, чтобы на одной станции одновременно находился только один поезд.
Программа создаёт восемь поездов, каждый из которых выполняется в собственном потоке, перемещается по маршруту туда и обратно и записывает в лог реальное время прибытия и отправления.

### Устройство программы
#### Станции
Каждая станция представлена структурой Station, которая содержит:
* название;
* мьютекс для ограничения доступа.

Мьютекс гарантирует, что одновременно на станции может находиться только один поезд.
Станции хранятся как указатели (Station*), чтобы избежать копирования объектов с мьютексами.
Список станций:
```txt
Dushanbe  
Vahdat  
Fayzobod  
Obigarm  
Nurobod  
Dangara
```
#### Поезда
Каждый поезд - это отдельный поток.
Поезд имеет:
* уникальный номер;
* индивидуальный маршрут (вектор указателей на станции);
* логику движения:
  * движение между станциями,
  * ожидание на станции,
  * логирование всех событий с текущим временем.

Всего используется 8 поездов:
* Поезда №1–4 стартуют из Душанбе в сторону Дангары.
* Поезда №5–8 идут в обратном направлении: стартуют из Дангары и движутся в сторону Душанбе.

Каждый поезд выполняет маршрут вперёд и назад, то есть совершает полный цикл.

#### Синхронизация на станциях
Каждая станция имеет собственный мьютекс:
```c++
std::unique_lock<std::mutex> lock(st->mutexStation);
```
**Алгоритм:**
* Поезд «подъезжает» к станции (7 секунд).
* Захватывает мьютекс станции — другие поезда ждут.
* Логирует прибытие.
* Стоит на станции 3 секунды.
* Логирует отправление.
* Освобождает мьютекс (автоматически).
* Между стартами поездов: 5 секунд, чтобы исключить одновременный старт всех потоков.

Это обеспечивает соблюдение **главного правила**:
никакие два поезда не могут одновременно находиться на одной станции.

### Пример лога выполнения
Ниже приведён реальный фрагмент вывода программы:
```txt
[2025-11-30 18:45:56] Train #1 arrived at station Dushanbe
[2025-11-30 18:45:59] Train #1 departed from station Dushanbe
[2025-11-30 18:46:01] Train #2 arrived at station Dushanbe
[2025-11-30 18:46:04] Train #2 departed from station Dushanbe
[2025-11-30 18:46:06] Train #1 arrived at station Vahdat
[2025-11-30 18:46:06] Train #3 arrived at station Dushanbe
[2025-11-30 18:46:09] Train #1 departed from station Vahdat
[2025-11-30 18:46:09] Train #3 departed from station Dushanbe
[2025-11-30 18:46:11] Train #4 arrived at station Dushanbe
[2025-11-30 18:46:11] Train #2 arrived at station Vahdat
[2025-11-30 18:46:14] Train #4 departed from station Dushanbe
[2025-11-30 18:46:14] Train #2 departed from station Vahdat
[2025-11-30 18:46:16] Train #5 arrived at station Dangara
[2025-11-30 18:46:16] Train #3 arrived at station Vahdat
[2025-11-30 18:46:16] Train #1 arrived at station Fayzobod
[2025-11-30 18:46:19] Train #5 departed from station Dangara
[2025-11-30 18:46:19] Train #3 departed from station Vahdat
[2025-11-30 18:46:19] Train #1 departed from station Fayzobod
[2025-11-30 18:46:21] Train #6 arrived at station Dangara
[2025-11-30 18:46:21] Train #4 arrived at station Vahdat
[2025-11-30 18:46:21] Train #2 arrived at station Fayzobod
```

В логе можно наблюдать:
* корректную очередь поездов на каждой станции;
* отсутствие пересечений двух поездов на одной станции;
* одновременную работу поездов на разных станциях;
* движение потоков в обе стороны;
* реальные задержки и временные интервалы.
